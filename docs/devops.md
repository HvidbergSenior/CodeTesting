# DevOps 
This document contains a description of different devOps topics.

## Build
### Frontend
Run debug:
1) From folder: ```\src\UI\Akkordplus\deftq.Akkordplus.Webapplication\client-app```
2) Install modules: ```npm i```
3) Run debug: ```npm run start```
#### Update Api swagger
Update: ```npm run api```
Fetches the OpenAPI spec from the backend which need to be running.
### Start backend in a docker container
1) From Folder: ```\src\Tools\Docker\```
2) First time or for new changes: ```.\build_and_start_api.bat```, Note! there must come a popup to approve certificate while building
3) Start, has been build: ```.\start_api.bat```

### Backend

Install .Net Core 6 SDK [https://dotnet.microsoft.com/en-us/download]()

Install JetBrains Rider [https://www.jetbrains.com/rider/]()

Open solution file in Rider [deftq.sln](../src/deftq.sln)

## Test

## Deployment

## Deployment in Development Environment
To enable frontend development with the latest backend API, it is possible to 
create docker images and run the containers locally. The scripts can be found
in the `src/Tools/Docker` folder and a description of the usage can be found 
here: [Readme.md](../src/Tools/Docker/Readme.md)

## Infrastructure (Terraform)

### Design

Terraform files can be found in the `terraform` folder in the root of the GIT repo. Modules are located in subfolder in `terraform/modules/{module}`. Base files for each environment can be found in folders `terraform/env/{environment}`.

The `environment` module located in `terraform/modules/environment` is base module for provisioning an environment. This module uses the other modules, and is the entry point used in the specific environment terraform files.

### Tooling

Download and install [Azure CLI](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli). Configure before using terraform with Azure:
```
az login
``` 

Download [Terraform CLI](https://developer.hashicorp.com/terraform/downloads), and make sure it's added to `PATH` environment variable.

From env folder (ex `terraform/env/dev`), configure terraform before running first time (after new sub module or new env):
```
terraform init -upgrade
``` 

### Running

From env folder (ex `terraform/env/dev`) perform a dry run with:
```
terraform plan
``` 
or apply the changes with:
```
terraform apply
```

### Notes from introduction

The `provider` entry is configuration of the required providers.

In `.tf` files, `Backend` keyword in `terraform` entry is where state is kept

The backend storage must be prepared before using Terraform. For first time run this requires Azure subscription, resource group, storage account and container exists.

## Secrets 

Database password is generated by terraform and stored in backend state. It is a manual task to find the secret in the state and update the Azure devOps pipeline variables.

Christoffer planned to use a keyvault solution instead to store passwords and share with application.

## Links to pulished servers
[Develop environment](https://dev-deftq-app.azurewebsites.net/)
[Demo Environment](https://demo-deftq-app.azurewebsites.net/)


